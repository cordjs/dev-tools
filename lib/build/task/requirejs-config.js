// Generated by CoffeeScript 1.9.1
(function() {
  var Future, _requirejsReady, path, pathToCore, requirejs;

  path = require('path');

  requirejs = require(process.cwd() + '/node_modules/requirejs');

  Future = require('../../utils/Future');

  pathToCore = 'bundles/cord/core';

  _requirejsReady = null;

  module.exports = function(targetDir) {

    /*
    First call initiates cordjs framework requirejs configuration (paths and so on).
    Returns a future which completes when requirejs is configured.
    All subsequent calls returns the same future.
    @param String targetDir target directory from which requirejs configuration should be loaded
    @return Future[Nothing]
     */
    var pathConfig;
    if (_requirejsReady == null) {
      pathConfig = require((path.join(targetDir, 'public', pathToCore)) + "/requirejs/pathConfig");
      requirejs.config({
        baseUrl: path.join(targetDir, 'public'),
        nodeRequire: require,
        paths: pathConfig
      });
      _requirejsReady = Future.require('pathUtils').then(function(pathUtils) {
        return pathUtils.setPublicPrefix('target/public');
      });
    }
    return _requirejsReady;
  };

}).call(this);
